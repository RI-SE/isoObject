project(ISO_object LANGUAGES C CXX)
cmake_minimum_required(VERSION 3.1)
set(CMAKE_C_STANDARD 14)
set(CMAKE_C_STANDARD_REQUIRED ON)

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

set(CMAKE_BUILD_TYPE Debug)

# Manage namespace of the project
set(ISOOBJECT_LIBRARY ${PARENT_TARGET_NAMESPACE}${PROJECT_NAME})
set(ISOOBJECT_TEST ${ISOOBJECT_LIBRARY}Test)

set(ISO22133_LIBRARY ${TARGET_NAMESPACE}ISO22133)
set(SOCKET_LIBRARY ${TARGET_NAMESPACE}TCPUDPSocket)
set(TIME_LIBRARY ${TARGET_NAMESPACE}MaestroTime)


include(GNUInstallDirs)

get_target_property(ISO22133_HEADERS ${ISO22133_LIBRARY} INCLUDE_DIRECTORIES)

# Library target
add_library(${ISOOBJECT_LIBRARY} SHARED
        ${CMAKE_CURRENT_SOURCE_DIR}/src/iso22133object.cpp
        ${CMAKE_CURRENT_SOURCE_DIR}/src/iso22133state.cpp
		${CMAKE_CURRENT_SOURCE_DIR}/src/trajDecoder.cpp
)

target_include_directories(${ISOOBJECT_LIBRARY} PUBLIC
	${CMAKE_CURRENT_SOURCE_DIR}/inc
	${CMAKE_CURRENT_SOURCE_DIR}/sigslot/include/sigslot
	${ISO22133_HEADERS}
)

target_link_libraries(${ISOOBJECT_LIBRARY} LINK_PUBLIC
	${SOCKET_LIBRARY}
	${ISO22133_LIBRARY}
	${TIME_LIBRARY}
	pthread
	atomic
)

set_property(TARGET ${ISOOBJECT_LIBRARY} PROPERTY
	PUBLIC_HEADER ${CMAKE_CURRENT_SOURCE_DIR}/inc/iso22133object.hpp
)

set_property(TARGET ${ISOOBJECT_LIBRARY} APPEND PROPERTY
	PUBLIC_HEADER ${CMAKE_CURRENT_SOURCE_DIR}/inc/iso22133state.hpp
)

set_property(TARGET ${ISOOBJECT_LIBRARY} APPEND PROPERTY
	PUBLIC_HEADER ${CMAKE_CURRENT_SOURCE_DIR}/inc/trajDecoder.hpp
)

set_property(TARGET ${ISOOBJECT_LIBRARY} APPEND PROPERTY
	PUBLIC_HEADER ${CMAKE_CURRENT_SOURCE_DIR}/sigslot/include/sigslot/signal.hpp
)

# Test target
add_executable(${ISOOBJECT_TEST} testIsoObject.cpp)

target_include_directories(${ISOOBJECT_TEST} PUBLIC
	${CMAKE_CURRENT_SOURCE_DIR}/inc
)

target_link_libraries(${ISOOBJECT_TEST} LINK_PUBLIC
	${ISOOBJECT_LIBRARY}
)

install(CODE "MESSAGE(STATUS \"Installing target ${ISOOBJECT_LIBRARY}\")")
install(TARGETS ${ISOOBJECT_LIBRARY}
	RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
	PUBLIC_HEADER DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}
)
